| debug code
| PHREDA 2015
|--------------------
^r4/lib/gui.txt
^r4/lib/btn.txt
^r4/lib/parse.txt
^r4/lib/codecolor.txt

^r4/lib/fontm.txt
^inc/fntm/droidsans13.txt

^r4/system/mem-ed.txt
^r4/ide/r4-token.txt
^r4/ide/r4-info.txt

^r4/ide/r4-tokenprint.txt

^r4/lib/trace.txt

#pantaini>	| comienzo de pantalla
#pantafin>	| fin de pantalla
#prilinea	| primera linea visible
#cntlinea

#fuente  	| fuente editable
#fuente> 	| cursor
#$fuente	| fin de texto

:loadtxt | -- cargar texto
	here dup 'fuente !
	'ed.nombre load dup '$fuente !
	0 swap c!+ 'here !
	;


|------- show debug word
#diccw

:printstackw
	diccw 4+ @	| >token
	diccw 12 + @ 20 >> $fff and	| >len
	( 1? )( swap
		sp @+ tokenstr print
		sp

		cr
		allowchome
		swap 1- ) 2drop
	;

:debugword
	dup 'diccw !
	show clrscr
		$6600 ink 1 linesfill
		verde ":R4" print blanco "sTACK " printx
        'ed.nombre "[%s] " print
		diccw @ print | nombre
		cr chome! blanco
        printstackw

		'exit >esc<
		;

|------ info code
:moreword | c -- c
	mark over 12 + @ ,printinfowor empty
	here amarillo oscuro
	'exit swap link |fillp blanco print
	;

:idef
	$f not and 'indicepal +
	sp
		|	dup @ print sp	| !!!nombre
	mark
	dup 12 + @ ,printmovword
	empty
	here azul
	'debugword swap link |fillp blanco print
	8 + @ $a0 and 1? ( moreword )
	drop ;

:ivar
	$f not and 'indicepal +
	sp
	8 + @
	6 >> vtype " %s "
	azul fillp blanco print ;

:ierr
	4 >> errormsg sp "!! %s "
	rojo fillp blanco print ;

:iwar
	amarillo " ! " print
	drop
	;

#tipoinfo 0 'idef 'ivar 'ierr 'iwar 0 0 0 0 0 0 0 0 0 0 0 0

:infoline
|	over prilinea + 2 << textinfo + @ | infolinea
	0? ( drop ; )
	dup $f and 2 << 'tipoinfo + @ exec ;

|------- show debug word
#diccw

:printstackw
	diccw 4+ @	| >token
	diccw 12 + @ 20 >> $fff and	| >len
	( 1? )( swap
		sp @+ tokenstr print
		sp

		cr
		allowchome
		swap 1- ) 2drop
	;

:debugword
	dup 'diccw !
	show clrscr
		$6600 ink 1 linesfill
		verde ":R4" print blanco "sTACK " printx
        'ed.nombre "[%s] " print
		diccw @ print | nombre
		cr chome! blanco
        printstackw

		'exit >esc<
		;


:tokerror
	4 << $03 or
|	errornrolinea 2 << textinfo + !
	;

:clearti
|	textinfo 1024 ( 1? )( 0 rot !+ swap 1- ) 2drop ;

|------------ recompilar
:recompilar
	home
	$6600 ink 1 linesfill
	verde dup ":R%d" print
	rojo "cOMPILANDO " printx
   'ed.nombre "[%s] " print
	redraw
	clearti
	mark
	fuente tokeniza
	empty
	1? ( tokerror ; )
	drop
	tokenpostall | analisis de palabras
|---- arma array info
|	fuente textinfo arrayinfo
|	1 'infomode !
	;


|------------ panel info
#panelinfo

:panelinfos
	panelinfo 1? ( drop 0 'panelinfo ! ; ) drop
	1 'panelinfo !
	|...........REHACER DEBUG
	recompilar
	;

:drawpanelinfo
	panelinfo 0? ( drop ; ) drop
	sw 2/ gc.right
	$3f alpha azul gc.fbox $ff alpha
	home cr blanco

|	codeprint cr
|	infodic cr
	;

:debugcode
	0 paper
	'fontdroidsans13 fontm
	clrscr
	rows 3 - 'cntlinea !
	4
	show clrscr
		$6600 ink 1 linesfill
		verde dup ":R%d" print
		blanco "dEBUG " printx
        'ed.nombre "[%s] " print
		cr

		'exit >esc<
		cminiflecha ;


:main
	mark
	ed.load
	loadtxt
	fuente tokeniza 1? ( drop ; ) drop
	debugcode
	;

: main ;