^r4/lib/gui.txt
^r4/lib/img.txt
^r4/lib/loadjpg.txt
^r4/lib/loadpng.txt
^r4/lib/trace.txt

^r4/lib/rfont.txt
^../r4/inc/rft/droidsansbold.rft


#recarga 0
#videos
#placas

#videonow
#placasnow

#marquesina
#tshadow $ffffff
#img1
#img2

:eventocheck
	;

|------------------- OS DEp ---------------------
:FNAME | adr -- adrname
|WIN|	44 +
|AND|	19 +
	;

:FDIR? | adr -- 1/0
|WIN|	@ $10
|AND|	18 + c@ 4
	=? ( 1 )( 0 ) nip ;

|------------------------------------------------
:addfile | adr --
	dup FDIR? 1? ( 2drop ; ) drop
	FNAME here strcpyl 'here !
	;

:getfilenames | path -- files
	here swap
	ffirst drop fnext drop | quita . y ..
	( fnext 1? )( addfile ) drop
	0 ,c
	;

|------------------------------------------------
:playffm | "" --
	"ffplay -fs -autoexit -loglevel quiet ""%s""" mprint system drop ;

:waitvideo
	( -1 system -1 <>? )( drop
		eventocheck
		100 update drop ) drop ;

:waitvideo
	show
		'exit >esc<
		-1 system -1 =? ( exit 0 system drop ) drop ;

:playvideo
	videonow playffm
	videonow >>0 dup c@ 0? ( 2drop videos ) drop 'videonow !
	;

:player
	-1 system -1 <>? ( drop ; ) drop
	playvideo ;

|------------------------------------------------
:playcartel

	;

|----------------------------------------
:sprint | "" --
	mprint
	ccx ccy ink@
	2 2 +atxy pick3
	tshadow ink printx
	ink atxy
	printx ;

#xm 0
:frente
	xm sh 90 - atxy
	rojo
	marquesina sprint
	-3 'xm +!
	;

:placa1
	sw 'xm !
	0 0 sw sh img1 img.drawsize >xfb
	.restart
	show xfb>scr
		frente
		'exit >esc<
		8000 .mseg exit
		;

:seq
	"videos/Spot Vacunación Antigripal 2015 ¿Quiénes deben vacunarse contra la gripe.mp4" playvideo
	waitvideo
	placa1
	;

|---------------
:info
	-1 system nip
	-1 =? ( "cartel" )( "video" )
	print cr
	;


:reread
	recarga 1? ( empty ) drop
	1 'recarga !
	mark
	"atv/videos/" getfilenames 'videos !
	"atv/placas/" getfilenames 'placas !

	videos 'videonow !
	placas 'placasnow !
	;

:dump	
		"videos" print cr
	videos ( dup c@ 1? )( drop
		dup print cr
		>>0 ) 2drop
	cr
	"placas" print cr
	placas ( dup c@ 1? )( drop
		dup print cr
		>>0 ) 2drop
	;

:main
	show clrscr

		"SYSteMA de video" print cr
|		info
|		playvideo

		player

		'exit >esc<
		cminiflecha ;

:ini
	mark
	reread
|	"placas/Calendario_de_vacunas_2014_web_1.jpg" loadjpg 'img1 !
|	"placas/Calendario_de_vacunas_2014_web_1.png" loadpng 'img1 !
|	"placas/Campana Vacunacion Antigripal 2015.png" loadpng 'img2 !
|	here dup 'marquesina !
|	"marquesina.txt" load 'here !
|	droidsansbold 32 rfont!
	;

: ini main ;