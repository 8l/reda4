| Juego 2015 - Itineriario
|------------------------
^r4/lib/gui.txt
^r4/lib/btn.txt
^r4/lib/trace.txt

^r4/lib/bmr.txt
^r4/dev/tiles.bmr

#xp #yp
#vxp #vyp
#axp #ayp 1

#estado


:debug
	scr verde
	yp xp "x:%d y:%d " print
	vyp vxp "vx:%d vy:%d " print
	ayp axp "ax:%d ay:%d " print
	;

|-------------------------------------------------
#escala 32
#escalap 5
#anchomapa 	32
#altomapa	18

#bloques 0 'puerta 'coin1 'escalera 'lava1 'piso 'tierra 'piedra2 'piedra2 'ladrillo 'ladrillo2 'pasto1 'tnt

#enemy1
1.0 2 13 16 16  	| vel x1 x2 y1 y2 vel
1.0 19 29 16 16
0

#mapa1
1 15 'enemy1
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
6 6 0 0 0 0 0 0 0 0 0 0 0 0 6 6 6 6 6 0 0 0 0 0 0 0 0 0 0 0 1 6
6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6

#mapa )( 8192


:dibujotile | n -- dib
|	2 =? ( drop 'acoin msec 5 >> $1c and + ; )
|	4 =? ( drop 'alava msec 6 >> $1c and + ; )
	$ff and 2 << 'bloques + @ ;

:dibujomapa
	'mapa >r
	0 ( altomapa <? )(
		0 ( anchomapa <? )(
			r@+ 0? ( drop )(
			    over escalap <<
			    pick3 escalap <<
				rot dibujotile
|				escala dup bmr.drawscale
				bmr.draw
				)
		1+ ) drop
	1+ ) drop
	rdrop
	;

:dibujomapa2
	-8 ( 8 <? )(
		-8 ( 8 <? )(
			over xp + over yp +
			1+ ) drop
		1+ ) drop

|-------------------------------------------------
:ninja
	vxp 'xp +!
	vyp 'yp +!
|	xp yp pos
	sw 2/ sh 2/ pos
	64 qdim
	rojo gc.fbox
	;

:teclado
	[ -1 'axp ! ; ] <le>
	[ 1 'axp ! ; ] <ri>
	[ 0 'axp ! ; ] dup >ri< >le<

    vxp
	axp 0? ( drop 0? ( dup )( sign neg ) ) | desacelera
	+
    10 >? ( 10 nip )
    -10 <? ( -10 nip )
    'vxp !


	1 'ayp +!
	[ -10 'ayp ! ; ] <up>
|	'bajar <dn>

	vyp ayp +
	10 >? ( 10 nip )
	-10 <? ( -10 nip )
	'vyp !

	yp sh 64 - >? ( sh 64 - 'yp ! ) drop
	;

|-------------------------------------------------
:copianivel | n --
	12 +
	'mapa >r
	anchomapa altomapa *
	( 1? )( swap
		@+ r!+ swap
		1- ) 2drop rdrop ;

:resetjuego
	0 'estado !
	0 'vxp !
	0 'vyp !
	sw 2/ 'xp !
	sh 2/ 'yp !
	'mapa1 copianivel
	;

:juego
	resetjuego
	show30 clrscr
		dibujomapa
		ninja
		teclado

		debug

		'exit >esc< ;

|-------------------------------------------------
:inicio
	mark
	;

: inicio juego ;